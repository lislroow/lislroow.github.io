<!DOCTYPE html>
<html lang="ko-kr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MEMO</title>
  <meta name="author" content="lislroow@daum.net">
  <meta name="description" content="KIM MYEONGGU&#39;s MEMO site">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/highlight/prism.css">
  <script src="/highlight/prism.js"></script>
</head>
<body>
  <header>
  <div class="navbar">
    <a href="https://lislroow.github.io/">MEMO</a>
    
    
      
      <div class="dropdown">
        <button class="dropbtn">&#43; archive</button>
        <div class="dropdown-content">
        
          <a href="/archive/apache/">apache</a>
        
          <a href="/archive/nginx/">nginx</a>
        
          <a href="/archive/oracle19c/">oracle19c</a>
        
          <a href="/archive/others/">others</a>
        
        </div>
      </div>
      
    
      
      <div class="dropdown">
        <button class="dropbtn">&#43; docker</button>
        <div class="dropdown-content">
        
          <a href="/system/ubuntu22-docker/">ubuntu22-docker</a>
        
        </div>
      </div>
      
    
    
    
    <a href="#" id="toggleTocButton" style="margin-left: auto;">+</a>
    <script>
    document.getElementById('toggleTocButton').addEventListener('click', function() {
      document.querySelector('.aside').classList.toggle('hidden');
    });
    </script>
  </div>
</header>

  
<main class="container">
  <div class="main-content">
    <div class="content">
      <article>
        <h1></h1>
        <div>
          <h4 id="8-sqlldr-우편번호-적재">8. sqlldr 우편번호 적재</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 우편번호 데이터
</span></span><span style="display:flex;"><span>$ curl -sOL https://www.epost.go.kr/search/areacd/zipcode_DB.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># zipcode.ctl 생성
</span></span><span style="display:flex;"><span>$ cat &lt;&lt;- EOF ./zipcode.ctl
</span></span><span style="display:flex;"><span>LOAD DATA
</span></span><span style="display:flex;"><span>CHARACTERSET AL32UTF8
</span></span><span style="display:flex;"><span>APPEND
</span></span><span style="display:flex;"><span>INTO TABLE CM_ZIPCODE_I
</span></span><span style="display:flex;"><span>FIELDS TERMINATED BY &#39;|&#39; 
</span></span><span style="display:flex;"><span>TRAILING NULLCOLS
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    zipcode CHAR,
</span></span><span style="display:flex;"><span>    sido CHAR,
</span></span><span style="display:flex;"><span>    sido_en CHAR,
</span></span><span style="display:flex;"><span>    sigungu CHAR,
</span></span><span style="display:flex;"><span>    sigungu_en CHAR,
</span></span><span style="display:flex;"><span>    eupmyun CHAR,
</span></span><span style="display:flex;"><span>    eupmyun_en CHAR,
</span></span><span style="display:flex;"><span>    road_cd CHAR,
</span></span><span style="display:flex;"><span>    road_nm CHAR,
</span></span><span style="display:flex;"><span>    road_nm_en CHAR,
</span></span><span style="display:flex;"><span>    underground_yn CHAR,
</span></span><span style="display:flex;"><span>    bldg_no1 CHAR,
</span></span><span style="display:flex;"><span>    bldg_no2 CHAR,
</span></span><span style="display:flex;"><span>    bldg_mgmt_no CHAR,
</span></span><span style="display:flex;"><span>    lg_delivery_nm CHAR,
</span></span><span style="display:flex;"><span>    sigungu_bldg_nm CHAR,
</span></span><span style="display:flex;"><span>    legal_dong_cd CHAR,
</span></span><span style="display:flex;"><span>    legal_dong_nm CHAR,
</span></span><span style="display:flex;"><span>    ri_name CHAR,
</span></span><span style="display:flex;"><span>    admin_dong_nm CHAR,
</span></span><span style="display:flex;"><span>    mountain_yn CHAR,
</span></span><span style="display:flex;"><span>    jibeon_no1 CHAR,
</span></span><span style="display:flex;"><span>    eupmyundong_seqno CHAR,
</span></span><span style="display:flex;"><span>    jibeon_no2 CHAR,
</span></span><span style="display:flex;"><span>    old_zipcode CHAR,
</span></span><span style="display:flex;"><span>    zipcode_seqno CHAR
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># CM_ZIPCODE_I 테이블 생성
</span></span><span style="display:flex;"><span>CREATE TABLE &#34;MKUSER&#34;.&#34;CM_ZIPCODE_I&#34; 
</span></span><span style="display:flex;"><span>   (  &#34;ZIPCODE&#34; VARCHAR2(10) NOT NULL ENABLE, 
</span></span><span style="display:flex;"><span>  &#34;SIDO&#34; VARCHAR2(50), 
</span></span><span style="display:flex;"><span>  &#34;SIDO_EN&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;SIGUNGU&#34; VARCHAR2(50), 
</span></span><span style="display:flex;"><span>  &#34;SIGUNGU_EN&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;EUPMYUN&#34; VARCHAR2(50), 
</span></span><span style="display:flex;"><span>  &#34;EUPMYUN_EN&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;ROAD_CD&#34; VARCHAR2(20), 
</span></span><span style="display:flex;"><span>  &#34;ROAD_NM&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;ROAD_NM_EN&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;UNDERGROUND_YN&#34; VARCHAR2(1), 
</span></span><span style="display:flex;"><span>  &#34;BLDG_NO1&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;BLDG_NO2&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;BLDG_MGMT_NO&#34; VARCHAR2(50), 
</span></span><span style="display:flex;"><span>  &#34;LG_DELIVERY_NM&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;SIGUNGU_BLDG_NM&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;LEGAL_DONG_CD&#34; VARCHAR2(20), 
</span></span><span style="display:flex;"><span>  &#34;LEGAL_DONG_NM&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;RI_NAME&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;ADMIN_DONG_NM&#34; VARCHAR2(100), 
</span></span><span style="display:flex;"><span>  &#34;MOUNTAIN_YN&#34; VARCHAR2(1), 
</span></span><span style="display:flex;"><span>  &#34;JIBEON_NO1&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;EUPMYUNDONG_SEQNO&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;JIBEON_NO2&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;OLD_ZIPCODE&#34; VARCHAR2(10), 
</span></span><span style="display:flex;"><span>  &#34;ZIPCODE_SEQNO&#34; VARCHAR2(10)
</span></span><span style="display:flex;"><span>   );
</span></span><span style="display:flex;"><span>COMMENT ON TABLE MKUSER.CM_ZIPCODE_I IS &#39;우편번호정보&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ZIPCODE IS &#39;우편번호&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.SIDO IS &#39;시도&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.SIDO_EN IS &#39;시도영문&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.SIGUNGU IS &#39;시군구&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.SIGUNGU_EN IS &#39;시군구영문&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.EUPMYUN IS &#39;읍면&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.EUPMYUN_EN IS &#39;읍면영문&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ROAD_CD IS &#39;도로명코드&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ROAD_NM IS &#39;도로명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ROAD_NM_EN IS &#39;도로명영문&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.UNDERGROUND_YN IS &#39;지하여부&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.BLDG_NO1 IS &#39;건물번호본번&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.BLDG_NO2 IS &#39;건물번호부번&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.BLDG_MGMT_NO IS &#39;건물관리번호&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.LG_DELIVERY_NM IS &#39;다량배달처명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.SIGUNGU_BLDG_NM IS &#39;시군구용건물명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.LEGAL_DONG_CD IS &#39;법정동코드&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.LEGAL_DONG_NM IS &#39;법정동명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.RI_NAME IS &#39;리명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ADMIN_DONG_NM IS &#39;행정동명&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.MOUNTAIN_YN IS &#39;산여부&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.JIBEON_NO1 IS &#39;지번본번&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.EUPMYUNDONG_SEQNO IS &#39;읍면동일련번호&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.JIBEON_NO2 IS &#39;지번부번&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.OLD_ZIPCODE IS &#39;구우편번호&#39;;
</span></span><span style="display:flex;"><span>COMMENT ON COLUMN MKUSER.CM_ZIPCODE_I.ZIPCODE_SEQNO IS &#39;우편번호일련번호&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 데이터 적재
</span></span><span style="display:flex;"><span>$ for file in *.txt; do
</span></span><span style="display:flex;"><span>  sqlldr mkuser/passwd@develop control=zipcode.ctl data=$file SKIP=1
</span></span><span style="display:flex;"><span>done
</span></span></code></pre></div><h4 id="7-데이터-이관-작업">7. 데이터 이관 작업</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># 임시 테이블스페이스, 계정 생성</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ALTER SESSION SET CONTAINER <span style="color:#f92672">=</span> develop;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CREATE TABLESPACE develop_test
</span></span><span style="display:flex;"><span>  DATAFILE <span style="color:#e6db74">&#39;/opt/oracle/oradata/ORCLCDB/develop/test.dbf&#39;</span> 
</span></span><span style="display:flex;"><span>  SIZE <span style="color:#ae81ff">100</span>M 
</span></span><span style="display:flex;"><span>  AUTOEXTEND ON 
</span></span><span style="display:flex;"><span>  NEXT <span style="color:#ae81ff">50</span>M MAXSIZE UNLIMITED;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ALTER SESSION SET <span style="color:#e6db74">&#34;_oracle_script&#34;</span><span style="color:#f92672">=</span>true;
</span></span><span style="display:flex;"><span>CREATE USER testuser IDENTIFIED BY <span style="color:#ae81ff">1</span> DEFAULT TABLESPACE develop_test;
</span></span><span style="display:flex;"><span>ALTER USER testuser QUOTA UNLIMITED ON develop_test;
</span></span><span style="display:flex;"><span>GRANT CREATE SESSION TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE TABLE TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE VIEW TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE PROCEDURE TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE SEQUENCE TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE TRIGGER TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE SYNONYM TO testuser;
</span></span><span style="display:flex;"><span>GRANT CREATE TYPE TO testuser;
</span></span><span style="display:flex;"><span>GRANT UNLIMITED TABLESPACE TO testuser;
</span></span><span style="display:flex;"><span>GRANT READ, WRITE ON DIRECTORY backup_dir TO testuser;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># imp 실행</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> NLS_LANG<span style="color:#f92672">=</span>KOREAN_KOREA<span style="color:#f92672">.</span>KO16MSWIN949
</span></span><span style="display:flex;"><span>imp system<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span> FILE<span style="color:#f92672">=./</span>backup<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log SHOW<span style="color:#f92672">=</span>Y FULL<span style="color:#f92672">=</span>Y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>imp system<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop FILE<span style="color:#f92672">=./</span>backup<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log FROMUSER<span style="color:#f92672">=</span>OCRM TOUSER<span style="color:#f92672">=</span>testuser ROWS<span style="color:#f92672">=</span>N
</span></span><span style="display:flex;"><span>imp system<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop FILE<span style="color:#f92672">=./</span>backup<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log FROMUSER<span style="color:#f92672">=</span>OCRM TOUSER<span style="color:#f92672">=</span>testuser ROWS<span style="color:#f92672">=</span>Y IGNORE<span style="color:#f92672">=</span>Y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (데이터 정리 후) exp 실행</span>
</span></span><span style="display:flex;"><span>expdp testuser<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop DIRECTORY<span style="color:#f92672">=</span>backup_dir DUMPFILE<span style="color:#f92672">=</span>exp<span style="color:#f92672">.</span>dmp TABLES<span style="color:#f92672">=</span>tb_foo,tb_bar LOGFILE<span style="color:#f92672">=</span>backup_log<span style="color:#f92672">.</span>log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># imp 실행</span>
</span></span><span style="display:flex;"><span>impdp mkuser<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop DIRECTORY<span style="color:#f92672">=</span>backup_dir DUMPFILE<span style="color:#f92672">=</span>exp<span style="color:#f92672">.</span>dmp REMAP_SCHEMA<span style="color:#f92672">=</span>testuser:mkuser REMAP_TABLESPACE<span style="color:#f92672">=</span>develop_test:develop LOGFILE<span style="color:#f92672">=</span>import_log<span style="color:#f92672">.</span>log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 임시 테이블스페이스, 계정 삭제</span>
</span></span><span style="display:flex;"><span>drop user testuser cascade;
</span></span><span style="display:flex;"><span>DROP TABLESPACE develop_test INCLUDING CONTENTS AND DATAFILES;
</span></span></code></pre></div><h4 id="6-expdp-명령pump으로-dump-생성하기">6. expdp 명령(pump)으로 dump 생성하기</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># backup 디렉토리 설정
</span></span><span style="display:flex;"><span>SQL&gt; CREATE DIRECTORY backup_dir AS &#39;/home/oracle/dump&#39;;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT READ, WRITE ON DIRECTORY backup_dir TO mkuser;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># expdp 명령 dump 생성
</span></span><span style="display:flex;"><span>$ expdp mkuser/passwd@develop DIRECTORY=backup_dir DUMPFILE=develop.dmp LOGFILE=develop_backup.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># impdp 명령 dump 적재 (for test)
</span></span><span style="display:flex;"><span># REMAP_SCHEMA=mkuser:testuser: 덤프 파일에 있는 데이터를 mkuser라는 원래 사용자로부터 testuser로 매핑하여 적재
</span></span><span style="display:flex;"><span>$ impdp testuser/passwd@testdb DIRECTORY=backup_dir DUMPFILE=develop.dmp REMAP_SCHEMA=mkuser:testuser LOGFILE=import_log.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># impdp 실행 전 디렉토리 생성
</span></span><span style="display:flex;"><span>SQL&gt; CREATE DIRECTORY backup_dir AS &#39;/home/oracle/dump&#39;;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT READ, WRITE ON DIRECTORY backup_dir TO testuser;
</span></span></code></pre></div><h4 id="5-dump-파일-import-하기">5. dump 파일 import 하기</h4>
<p>imp 명령어와 impdp 명령어가 있으며, exp 로 생성한 dump 는 imp 로 import 해야 함</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># dump 파일의 메타 정보 확인</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> imp system<span style="color:#f92672">/</span>passwd FILE<span style="color:#f92672">=/</span>opt<span style="color:#f92672">/</span>dump<span style="color:#f92672">/</span>fund<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log SHOW<span style="color:#f92672">=</span>Y FULL<span style="color:#f92672">=</span>Y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dump 파일의 캐릭터셋은 NLS_LANG 변수로 설정</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> <span style="color:#66d9ef">export</span> NLS_LANG<span style="color:#f92672">=</span>KOREAN_KOREA<span style="color:#f92672">.</span>KO16MSWIN949
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># only schema import</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> imp system<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop FILE<span style="color:#f92672">=/</span>opt<span style="color:#f92672">/</span>dump<span style="color:#f92672">/</span>fund<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log FROMUSER<span style="color:#f92672">=</span>FUNDO TOUSER<span style="color:#f92672">=</span>mkuser ROWS<span style="color:#f92672">=</span>N
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># data import (ignore=Y 는 schema 가 있을 경우 무시하고 data 를 import)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> imp system<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">@</span>develop FILE<span style="color:#f92672">=/</span>opt<span style="color:#f92672">/</span>dump<span style="color:#f92672">/</span>fund<span style="color:#f92672">.</span>dmp LOG<span style="color:#f92672">=</span>dump_log<span style="color:#f92672">.</span>log FROMUSER<span style="color:#f92672">=</span>FUNDO TOUSER<span style="color:#f92672">=</span>mkuser ROWS<span style="color:#f92672">=</span>Y IGNORE<span style="color:#f92672">=</span>Y
</span></span></code></pre></div><p>system 테이블스페이스에는 데이터를 import 할 수 없음</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># pdb 선택
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET CONTAINER = develop;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 테이블스페이스 생성
</span></span><span style="display:flex;"><span>SQL&gt; CREATE TABLESPACE develop
</span></span><span style="display:flex;"><span>  DATAFILE &#39;/opt/oracle/oradata/ORCLCDB/develop/develop.dbf&#39; 
</span></span><span style="display:flex;"><span>  SIZE 10G 
</span></span><span style="display:flex;"><span>  AUTOEXTEND ON 
</span></span><span style="display:flex;"><span>  NEXT 50M MAXSIZE UNLIMITED;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># mkuser 기본 테이블스페이스 지정 및 할당량 지정
</span></span><span style="display:flex;"><span>SQL&gt; ALTER USER mkuser DEFAULT TABLESPACE develop;
</span></span><span style="display:flex;"><span>SQL&gt; ALTER USER mkuser QUOTA UNLIMITED ON develop;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb 선택
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET CONTAINER = develop;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># mkuser 계정 삭제
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET &#34;_oracle_script&#34;=true;
</span></span><span style="display:flex;"><span>SQL&gt; DROP USER mkuser CASCADE;
</span></span><span style="display:flex;"><span># ORA-28014: cannot drop administrative user or role
</span></span><span style="display:flex;"><span>SQL&gt; SELECT * FROM dba_role_privs WHERE grantee = &#39;mkuser&#39;;
</span></span><span style="display:flex;"><span>SQL&gt; REVOKE SYSDBA FROM mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; REVOKE DBA FROM mkuser;
</span></span><span style="display:flex;"><span># ORA-01940: cannot drop a user that is currently connected
</span></span><span style="display:flex;"><span>SQL&gt; SELECT SID,SERIAL# FROM V$SESSION WHERE USERNAME = &#39;MKUSER&#39;;
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SYSTEM KILL SESSION &#39;SID,SERIAL#&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 테이블스페이스 삭제 (dbf 파일은 삭제되지 않음)
</span></span><span style="display:flex;"><span>SQL&gt; DROP TABLESPACE develop;
</span></span><span style="display:flex;"><span>SQL&gt; DROP TABLESPACE develop INCLUDING CONTENTS AND DATAFILES;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># dbf 파일 삭제
</span></span><span style="display:flex;"><span>$ rm -rf /opt/oracle/oradata/ORCLCDB/develop/develop.dbf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># mkuser 계정 생성 (기본 테이블스페이스 지정)
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET &#34;_oracle_script&#34;=true;
</span></span><span style="display:flex;"><span>SQL&gt; CREATE USER mkuser IDENTIFIED BY 1 DEFAULT TABLESPACE develop;
</span></span></code></pre></div><h4 id="4-pdb-삭제">4. pdb 삭제</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SQL&gt; SHOW PDBS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CON_ID CON_NAME       OPEN MODE  RESTRICTED
</span></span><span style="display:flex;"><span>---------- ------------------------------ ---------- ----------
</span></span><span style="display:flex;"><span>   2 PDB$SEED       READ ONLY  NO
</span></span><span style="display:flex;"><span>   3 ORCLPDB1       READ WRITE NO
</span></span><span style="display:flex;"><span>   4 MARKET         READ WRITE NO
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span># pdb close 상태로 전환
</span></span><span style="display:flex;"><span>SQL&gt; ALTER PLUGGABLE DATABASE market CLOSE IMMEDIATE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Pluggable database altered.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb unplug
</span></span><span style="display:flex;"><span>SQL&gt; ALTER PLUGGABLE DATABASE market UNPLUG INTO &#39;/home/oracle/market.xml&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Pluggable database altered.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb 상태 확인
</span></span><span style="display:flex;"><span>SQL&gt; SHOW PDBS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CON_ID CON_NAME       OPEN MODE  RESTRICTED
</span></span><span style="display:flex;"><span>---------- ------------------------------ ---------- ----------
</span></span><span style="display:flex;"><span>   2 PDB$SEED       READ ONLY  NO
</span></span><span style="display:flex;"><span>   3 ORCLPDB1       READ WRITE NO
</span></span><span style="display:flex;"><span>   4 MARKET         MOUNTED
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb 삭제
</span></span><span style="display:flex;"><span>SQL&gt; DROP PLUGGABLE DATABASE market INCLUDING DATAFILES;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Pluggable database dropped.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb 상태 확인
</span></span><span style="display:flex;"><span>SQL&gt; SHOW PDBS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CON_ID CON_NAME       OPEN MODE  RESTRICTED
</span></span><span style="display:flex;"><span>---------- ------------------------------ ---------- ----------
</span></span><span style="display:flex;"><span>   2 PDB$SEED       READ ONLY  NO
</span></span><span style="display:flex;"><span>   3 ORCLPDB1       READ WRITE NO
</span></span></code></pre></div><h4 id="3-새로운-pdb-생성-및-계정-생성">3. 새로운 pdb 생성 및 계정 생성</h4>
<h5 id="31-pdb-생성">3.1 pdb 생성</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 접속
</span></span><span style="display:flex;"><span>$ sqlplus sys as sysdba
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 데이터베이스 상태 확인
</span></span><span style="display:flex;"><span>SQL&gt; SELECT STATUS FROM V$INSTANCE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 현재 세션을 CDB 로 변경하고, 변경 여부 확인
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET CONTAINER = CDB$ROOT;
</span></span><span style="display:flex;"><span>SQL&gt; SHOW CON_NAME;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># pdb 생성
</span></span><span style="display:flex;"><span>SQL&gt; CREATE PLUGGABLE DATABASE market ADMIN USER pdb_market IDENTIFIED BY 1 FILE_NAME_CONVERT = (&#39;/opt/oracle/oradata/ORCLCDB&#39;, &#39;/opt/oracle/oradata/ORCLCDB/market&#39;);
</span></span><span style="display:flex;"><span>SQL&gt; CREATE PLUGGABLE DATABASE develop ADMIN USER pdb_market IDENTIFIED BY 1 FILE_NAME_CONVERT = (&#39;/opt/oracle/oradata/ORCLCDB&#39;, &#39;/opt/oracle/oradata/ORCLCDB/develop&#39;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Pluggable database created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 생성된 pdb 확인
</span></span><span style="display:flex;"><span>SQL&gt; SHOW PDBS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CON_ID CON_NAME       OPEN MODE  RESTRICTED
</span></span><span style="display:flex;"><span>---------- ------------------------------ ---------- ----------
</span></span><span style="display:flex;"><span>   2 PDB$SEED       READ ONLY  NO
</span></span><span style="display:flex;"><span>   3 ORCLPDB1       READ WRITE NO
</span></span><span style="display:flex;"><span>   4 MARKET         READ WRITE NO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 생성된 pdb 시작(OPEN)
</span></span><span style="display:flex;"><span>SQL&gt; ALTER PLUGGABLE DATABASE market OPEN;
</span></span></code></pre></div><h5 id="32-새로운-pdb-에-user-생성">3.2 새로운 pdb 에 user 생성</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 현재 세션이 연결된 컨테이너 확인
</span></span><span style="display:flex;"><span>SQL&gt; SHOW CON_NAME;
</span></span><span style="display:flex;"><span>CON_NAME
</span></span><span style="display:flex;"><span>------------------------------
</span></span><span style="display:flex;"><span>CDB$ROOT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 현재 세션을 PDB 로 변경
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET CONTAINER = market;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Session altered.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># PDB 로 세션 변경이 되었는지 확인 
</span></span><span style="display:flex;"><span>SQL&gt; SHOW CON_NAME;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CON_NAME
</span></span><span style="display:flex;"><span>------------------------------
</span></span><span style="display:flex;"><span>MARKET
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># &#39;ORA-65096: invalid common user or role name&#39; 오류 발생
</span></span><span style="display:flex;"><span>SQL&gt; ALTER SESSION SET &#34;_oracle_script&#34;=true;
</span></span><span style="display:flex;"><span>SQL&gt; CREATE USER mkuser IDENTIFIED BY 1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># GRANT RESOURCE TO mkuser (ORA-01924: role &#39;RESOURCE&#39; not granted or does not exist)
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE SESSION TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE TABLE TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE VIEW TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE PROCEDURE TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE SEQUENCE TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE TRIGGER TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE SYNONYM TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT CREATE TYPE TO mkuser;
</span></span><span style="display:flex;"><span>SQL&gt; GRANT UNLIMITED TABLESPACE TO mkuser;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># tnsnames.ora 추가 (sqlplus,imp,exp 사용시)
</span></span><span style="display:flex;"><span>/opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
</span></span><span style="display:flex;"><span>market =
</span></span><span style="display:flex;"><span>  (DESCRIPTION =
</span></span><span style="display:flex;"><span>    (ADDRESS = (PROTOCOL = TCP)(HOST = rocky8-oracle19c)(PORT = 1521))
</span></span><span style="display:flex;"><span>    (CONNECT_DATA =
</span></span><span style="display:flex;"><span>      (SERVER = DEDICATED)
</span></span><span style="display:flex;"><span>      (SERVICE_NAME = market)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><h4 id="2-oracle19c-환경-정보">2. oracle19c 환경 정보</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># 설치 경로(디렉토리) 확인</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cat /etc/oratab</span>
</span></span><span style="display:flex;"><span>ORCLCDB:<span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>oracle<span style="color:#f92672">/</span>product<span style="color:#f92672">/</span><span style="color:#ae81ff">19</span>c<span style="color:#f92672">/</span>dbhome_1:Y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 서비스명 확인</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># systemctl list-units | grep oracle</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> oracledb_ORCLCDB<span style="color:#f92672">-</span><span style="color:#ae81ff">19</span>c<span style="color:#f92672">.</span>service  loaded active running   SYSV: This script is responsible <span style="color:#66d9ef">for</span> taking care of configuring the Oracle Database <span style="color:#f92672">and</span> its associated services<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 서비스 실행 확인</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># systemctl status oracledb_ORCLCDB-19c</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>rc<span style="color:#f92672">.</span>d<span style="color:#f92672">/</span>init<span style="color:#f92672">.</span>d<span style="color:#f92672">/</span>oracledb_ORCLCDB<span style="color:#f92672">-</span><span style="color:#ae81ff">19</span>c
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lsnrctl status | grep -n Service</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># listener 에 등록된 서비스명 확인 (ORCLCDB)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">22</span>:Services Summary<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">23</span>:Service <span style="color:#e6db74">&#34;1db7b95ef20a357be0633cc81cac0df1&#34;</span> has <span style="color:#ae81ff">1</span> instance(s)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span>:Service <span style="color:#e6db74">&#34;1db9133561fa1204e0633cc81cac10e9&#34;</span> has <span style="color:#ae81ff">1</span> instance(s)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">27</span>:Service <span style="color:#e6db74">&#34;ORCLCDB&#34;</span> has <span style="color:#ae81ff">2</span> instance(s)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">30</span>:Service <span style="color:#e6db74">&#34;ORCLCDBXDB&#34;</span> has <span style="color:#ae81ff">1</span> instance(s)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">34</span>:Service <span style="color:#e6db74">&#34;orclpdb1&#34;</span> has <span style="color:#ae81ff">1</span> instance(s)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ORCLCDB 에 접속</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sqlplus system/passwd@localhost:1521/ORCLCDB</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 인스턴스 확인 (OPEN 이 되어야 함)</span>
</span></span><span style="display:flex;"><span>SQL<span style="color:#f92672">&gt;</span> select status from v<span style="color:#f92672">$</span>instance;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>STATUS
</span></span><span style="display:flex;"><span><span style="color:#f92672">------------</span>
</span></span><span style="display:flex;"><span>OPEN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CDB 여부 확인</span>
</span></span><span style="display:flex;"><span>SQL<span style="color:#f92672">&gt;</span> select name, cdb from v<span style="color:#f92672">$</span>database;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME    CDB
</span></span><span style="display:flex;"><span><span style="color:#f92672">---------</span> <span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span>ORCLCDB   YES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SQL<span style="color:#f92672">&gt;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pdb 확인</span>
</span></span><span style="display:flex;"><span>SQL<span style="color:#f92672">&gt;</span> select con_id, name, open_mode from v<span style="color:#f92672">$</span>pdbs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  CON_ID NAME                                 OPEN_MODE
</span></span><span style="display:flex;"><span><span style="color:#f92672">----------</span> <span style="color:#f92672">-------------------------------------------------</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">2</span> PDB<span style="color:#f92672">$</span>SEED                                 READ ONLY
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">3</span> ORCLPDB1                                 READ WRITE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 클라이언트에서 rocky8-oracle19:1521/orclpdb1 접속</span>
</span></span><span style="display:flex;"><span>orclpdb1 <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  (DESCRIPTION <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    (ADDRESS <span style="color:#f92672">=</span>(PROTOCOL<span style="color:#f92672">=</span>TCP)(HOST<span style="color:#f92672">=</span><span style="color:#ae81ff">172.28</span><span style="color:#f92672">.</span><span style="color:#ae81ff">200.60</span>)(PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">1521</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  (CONNECT_DATA <span style="color:#f92672">=</span>(SERVICE_NAME<span style="color:#f92672">=</span>orclpdb1)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h4 id="1-oracle19c-설치">1. oracle19c 설치</h4>
<p>생략</p>

        </div>
      </article>
    </div>
  </div>
  <aside class="aside">



<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li>
              <ul>
                <li><a href="#8-sqlldr-우편번호-적재">8. sqlldr 우편번호 적재</a></li>
                <li><a href="#7-데이터-이관-작업">7. 데이터 이관 작업</a></li>
                <li><a href="#6-expdp-명령pump으로-dump-생성하기">6. expdp 명령(pump)으로 dump 생성하기</a></li>
                <li><a href="#5-dump-파일-import-하기">5. dump 파일 import 하기</a></li>
                <li><a href="#4-pdb-삭제">4. pdb 삭제</a></li>
                <li><a href="#3-새로운-pdb-생성-및-계정-생성">3. 새로운 pdb 생성 및 계정 생성</a>
                  <ul>
                    <li><a href="#31-pdb-생성">3.1 pdb 생성</a></li>
                    <li><a href="#32-새로운-pdb-에-user-생성">3.2 새로운 pdb 에 user 생성</a></li>
                  </ul>
                </li>
                <li><a href="#2-oracle19c-환경-정보">2. oracle19c 환경 정보</a></li>
                <li><a href="#1-oracle19c-설치">1. oracle19c 설치</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



</aside>

</main>

  <footer class="footer">
Designed by MK
</footer>
</body>
</html>
